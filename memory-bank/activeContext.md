# Goosuke アクティブコンテキスト

## 現在の作業フォーカス

現在、Goosukeプロジェクトは初期開発段階にあります。主なフォーカスは以下の通りです：

1. **拡張機能管理の強化**: エラーハンドリングと自動インストール機能の実装
2. **Discord連携の改善**: 会議要約機能の強化と設定の柔軟性向上
3. **テストカバレッジの向上**: 単体テストと統合テストの拡充
4. **タスクテンプレート機能の強化**: 再利用可能なテンプレートの機能強化
5. **拡張機能と秘密情報の連携強化**: 拡張機能に関連する秘密情報の安全な管理
6. **MCPプロトコル実装の改善**: Discord MCPサーバーの安定性向上とSSE接続の問題解決

## 最近の変更

最近の主な変更点は以下の通りです：

1. **タスクモデルの分割**: タスクモデルをテンプレート（TaskTemplate）と実行（TaskExecution）に分割
2. **Discord設定モデル追加**: Discord固有の設定を管理するモデル（ConfigDiscord）を追加
3. **アクション設定関連モデル追加**: アクションと設定の関連付けを管理するモデル（ActionConfig）を追加
4. **拡張機能モデル構造の更新**: 拡張機能モデルの構造を変更し、より具体的なフィールドを追加
5. **Goose設定同期機能の追加**: GoosukeとGoose間で拡張機能設定を同期する機能を追加
6. **拡張機能サービスの実装**: 拡張機能の管理と設定同期機能を実装
7. **テスト方針の強化**: テストデータベース接続、トランザクション管理などのテスト方針を強化
8. **非同期データベース接続の改善**: `_get_db_context`を使用したコンテキスト管理の改善
9. **秘密情報管理機能の追加**: 設定と拡張機能に関連する秘密情報の暗号化・復号化機能を実装
10. **テスト環境の強化**: テスト用データベース設定の改善とテストカバレッジの向上
11. **Discord MCP サーバーの実装**: MCPプロトコルを使用したDiscord連携機能の実装
12. **MCP SSEトランスポートの実装**: Server-Sent Events（SSE）を使用したMCPサーバーの実装

## 次のステップ

次のステップは以下の通りです：

1. **拡張機能のインストール機能の自動化**: 現在は手動インストールが必要な拡張機能の自動インストール機能の実装。MCPプロトコル（Model Context Protocol）を活用し、AIモデルと外部ツール間の通信を標準化する。具体的な実装計画は以下の通り：
   - フロントエンド実装後に取り組む予定
   - TaskTemplate作成画面でユーザーがプロンプトを入力した際に、Gooseエージェントがそのプロンプトを分析し、必要なMCPサーバーの種類を自動検出
   - 検出したMCPサーバーの種類を元に、MCP Server Directoryを検索し、インストールすべきMCPサーバーのリストをユーザーに提示
   - ユーザーが選択したMCPサーバーのGitHubリポジトリを参照し、Gooseエージェントが設定パラメータを自動抽出してJSONでレスポンス
   - フロントエンドでExtension追加モーダルを表示し、必要なパラメータが事前に入力された状態でフォームを表示
   - ユーザーは「追加」ボタンを押すだけで拡張機能をインストール可能
2. **Discord MCP サーバーのSSE接続問題の解決**: 現在SSE接続がすぐにDisconnectedになる問題を解決する
3. **タスクテンプレート機能の強化**: 再利用可能なタスクテンプレートの機能を強化
4. **タスク実行履歴の管理**: タスク実行履歴の管理機能を実装
5. **テストカバレッジの向上**: 統合テストとモックを使用したテストの拡充
6. **ドキュメントの拡充**: APIリファレンスとデベロッパーガイドの拡充

## アクティブな決定事項

現在のプロジェクトに関する主な決定事項は以下の通りです：

1. **SQLiteの使用**: 小規模用途向けにSQLiteを使用する
2. **FastAPIの採用**: APIフレームワークとしてFastAPIを採用する
3. **Discord連携の優先**: 外部サービス連携としてDiscordを優先する
4. **JWTベースの認証**: シンプルなJWTベースの認証を使用する
5. **Docker Composeによるデプロイ**: Docker Composeを使用したデプロイを優先する
6. **Goose CLIの活用**: タスク実行にGoose CLIを活用する
7. **アクションとタスクの概念**: システム設計の中核として「アクション」と「タスク」の概念を採用する
8. **タスクモデルの分割**: タスクモデルをテンプレートと実行に分割し、より柔軟な設計にする
9. **設定の分離**: Discord設定などの特定サービス向け設定を専用モデルで管理する
10. **拡張機能モデルの構造**: 拡張機能モデルを具体的なフィールドで構成する
11. **テスト方針の強化**: テストではトランザクションを活用し、テスト間の独立性を確保する
12. **秘密情報の暗号化管理**: 秘密情報はデータベースに暗号化して保存し、必要時に復号化する
13. **MCPプロトコルの採用**: AIモデルと外部ツール間の通信にMCPプロトコルを採用する
14. **SSEトランスポートの使用**: MCPサーバーのトランスポートとしてSSE（Server-Sent Events）を使用する

## 現在の課題

現在のプロジェクトに関する主な課題は以下の通りです：

1. **Goose CLIの設定**: Goose CLIの設定を簡素化する必要がある
2. **非同期処理の最適化**: 長時間実行タスクの非同期処理を最適化する必要がある
3. **拡張機能設定の同期の信頼性向上**: GoosukeとGoose間の拡張機能設定の同期処理の信頼性を向上させる必要がある
4. **拡張機能のインストール機能**: 現在は手動インストールが必要な拡張機能の自動インストール機能を実装する必要がある
5. **拡張機能の依存関係管理**: 拡張機能間の依存関係を適切に管理する仕組みが必要
6. **SSE接続の安定性**: Discord MCPサーバーのSSE接続がすぐにDisconnectedになる問題を解決する必要がある
7. **MCPサーバーのエラーハンドリング**: MCPサーバーのエラーハンドリングを強化する必要がある

## 現在の検討事項

現在検討中の事項は以下の通りです：

1. **PostgreSQLサポート**: 中規模用途向けにPostgreSQLサポートを追加するか
2. **Redisサポート**: キャッシュとキューイングにRedisを使用するか
3. **Slack連携**: Slack連携を追加するか
4. **管理画面**: シンプルな管理画面を追加するか
5. **マルチテナンシー**: マルチテナンシーをサポートするか
6. **拡張機能マーケットプレイス**: 拡張機能のマーケットプレイスを実装するか
7. **拡張機能のバージョン管理**: 拡張機能のバージョン管理をどのように実装するか
8. **追加のMCPサーバー**: Discord以外のサービス向けのMCPサーバーを実装するか
9. **MCPサーバーディレクトリ**: MCPサーバーの検索と自動インストールのためのディレクトリサービスをどのように実装するか
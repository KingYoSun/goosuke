# Goosuke アクティブコンテキスト

## 現在の作業フォーカス

現在、Goosukeプロジェクトは初期開発段階にあります。主なフォーカスは以下の通りです：

1. **基本機能の実装**: 発火レイヤーと実行レイヤーの基本機能を実装
2. **Discord連携**: Discord Botを使用した会議要約機能の実装
3. **API開発**: RESTful APIの開発とドキュメント作成
4. **認証システム**: JWTベースの認証システムの実装
5. **データベース設計**: SQLiteデータベースのスキーマ設計とマイグレーション
6. **セキュリティ強化**: 認証情報の安全な管理とセキュリティ対策の実装
7. **タスクモデルの改善**: タスクモデルをテンプレートと実行に分割
8. **設定管理の強化**: Discord設定とアクション設定の関連付け機能の実装
9. **拡張機能管理の強化**: Goose拡張機能の管理と同期機能の実装

## 最近の変更

最近の主な変更点は以下の通りです：

1. **プロジェクト初期化**: プロジェクトの基本構造を設定
2. **データベースマイグレーション**: 初期データベーススキーマを作成
3. **Discord Bot実装**: 基本的なDiscord Bot機能を実装
4. **API実装**: 基本的なAPIエンドポイントを実装
5. **認証システム実装**: JWTベースの認証システムを実装
6. **テスト追加**: 単体テストと統合テストを追加
7. **Docker設定**: Docker ComposeとDockerfileを設定
8. **Goose CLI連携**: Goose CLIとの連携機能を実装し、タスク実行の基盤を構築
9. **タスクモデル分割**: タスクモデルをテンプレート（TaskTemplate）と実行（TaskExecution）に分割し、より柔軟な設計に変更
10. **Discord設定モデル追加**: Discord固有の設定を管理するモデル（ConfigDiscord）を追加
11. **アクション設定関連モデル追加**: アクションと設定の関連付けを管理するモデル（ActionConfig）を追加
12. **エラーハンドリング改善**: Discord Botのエラーハンドリングを改善
13. **データベース接続改善**: `get_db`関数を`_get_db_context`に変更し、コンテキスト管理を改善
14. **古いタスクテーブルの削除**: 新しいタスクモデル構造への完全移行を完了し、古いタスクテーブルを削除
15. **拡張機能モデル構造の更新**: 拡張機能モデルの構造を変更し、`config`フィールドを削除して、より具体的なフィールド（`type`, `cmd`, `args`, `timeout`, `envs`）を追加
16. **Goose設定同期機能の追加**: GoosukeとGoose間で拡張機能設定を同期する機能を追加
17. **テスト方針の強化**: テストデータベース接続、トランザクション管理、テーブル作成パターンなどのテスト方針を強化
18. **clones/ディレクトリの追加**: コンテキスト用リポジトリクローンフォルダを追加し、開発環境から除外

## 次のステップ

次のステップは以下の通りです：

1. **拡張機能システムの実装**: Goose拡張機能の管理機能を実装
2. **タスクテンプレート機能の強化**: 再利用可能なタスクテンプレートの機能を強化
3. **ユーザーインターフェースの改善**: APIドキュメントとエラーメッセージの改善
4. **テストカバレッジの向上**: テストカバレッジを向上させる
5. **パフォーマンス最適化**: リソース使用量の最適化
6. **セキュリティ強化**: セキュリティ機能の強化（特に認証情報の安全な管理）
7. **ドキュメントの充実**: ユーザーガイドとデベロッパーガイドの充実
8. **Discord設定管理の強化**: Discord設定の管理機能を強化
9. **アクション設定関連の強化**: アクションと設定の関連付け機能を強化
10. **タスク実行履歴の管理**: タスク実行履歴の管理機能を実装
11. **拡張機能設定の同期機能の強化**: GoosukeとGoose間の拡張機能設定の同期機能を強化
12. **拡張機能のインストール・アンインストール機能**: 拡張機能のインストールとアンインストールを管理する機能を実装

## アクティブな決定事項

現在のプロジェクトに関する主な決定事項は以下の通りです：

1. **SQLiteの使用**: 小規模用途向けにSQLiteを使用する
2. **FastAPIの採用**: APIフレームワークとしてFastAPIを採用する
3. **Discord連携の優先**: 外部サービス連携としてDiscordを優先する
4. **JWTベースの認証**: シンプルなJWTベースの認証を使用する
5. **Docker Composeによるデプロイ**: Docker Composeを使用したデプロイを優先する
6. **Goose CLIの活用**: タスク実行にGoose CLIを活用する
7. **アクションとタスクの概念**: システム設計の中核として「アクション」と「タスク」の概念を採用する
8. **Anthropicプロバイダーの使用**: Goose CLIのLLMプロバイダーとしてAnthropicを使用する
9. **タスクモデルの分割**: タスクモデルをテンプレートと実行に分割し、より柔軟な設計にする
10. **設定の分離**: Discord設定などの特定サービス向け設定を専用モデルで管理する
11. **アクションと設定の関連付け**: アクションと設定の関連付けを専用モデルで管理する
12. **データベース接続の改善**: 非同期コンテキスト管理のために`_get_db_context`を使用する
13. **拡張機能モデルの構造**: 拡張機能モデルを具体的なフィールド（`type`, `cmd`, `args`, `timeout`, `envs`）で構成する
14. **テスト方針の強化**: テストではトランザクションを活用し、テスト間の独立性を確保する

## 現在の課題

現在のプロジェクトに関する主な課題は以下の通りです：

1. **Goose CLIの設定**: Goose CLIの設定を簡素化する必要がある
2. **非同期処理の最適化**: 長時間実行タスクの非同期処理を最適化する必要がある
3. **エラーハンドリングの改善**: エラーハンドリングとロギングを改善する必要がある
4. **テストの充実**: モックを使用した統合テストを充実させる必要がある
5. **ドキュメントの充実**: ユーザーガイドとデベロッパーガイドを充実させる必要がある
6. **リソース使用量の最適化**: コンテナのリソース使用量を最適化する必要がある
7. **セキュリティの強化**: 認証情報（APIキーやトークン）の安全な管理方法を実装する必要がある
8. **ANSIコード処理の改善**: Goose CLIの出力からANSIコードを適切に除去する処理の改善
9. **Discord設定の柔軟性向上**: より多様なDiscordイベントに対応できるよう設定の柔軟性を向上させる
10. **設定タイプの拡張**: 現在はDiscordとSlackのみだが、他の設定タイプも追加する必要がある
11. **データベース接続の最適化**: 非同期データベース接続のパフォーマンス最適化が必要
12. **拡張機能設定の同期**: GoosukeとGoose間の拡張機能設定の同期を確実に行う必要がある

## 現在の検討事項

現在検討中の事項は以下の通りです：

1. **PostgreSQLサポート**: 中規模用途向けにPostgreSQLサポートを追加するか
2. **Redisサポート**: キャッシュとキューイングにRedisを使用するか
3. **Slack連携**: Slack連携を追加するか
4. **管理画面**: シンプルな管理画面を追加するか
5. **マルチテナンシー**: マルチテナンシーをサポートするか
6. **ロールベースのアクセス制御**: より詳細なロールベースのアクセス制御を実装するか
7. **拡張機能マーケットプレイス**: 拡張機能のマーケットプレイスを実装するか
8. **環境変数の暗号化**: 機密性の高い環境変数（APIキーなど）の暗号化または安全な管理方法
9. **タスク実行履歴の保持期間**: タスク実行履歴の保持期間をどのように設定するか
10. **設定タイプの拡張**: Discord以外の設定タイプ（Slack、Webhookなど）をどのように実装するか
11. **メッセージ収集戦略の拡張**: 現在のシングル、スレッド、範囲以外のメッセージ収集戦略を追加するか
12. **拡張機能のバージョン管理**: 拡張機能のバージョン管理をどのように実装するか
13. **拡張機能の依存関係管理**: 拡張機能間の依存関係をどのように管理するか